{%- liquid
  if collection
    assign product_url = product.url | within: collection
  else
    assign product_url = product.url
  endif

  assign product_images = product.media | where: 'media_type', 'image'
  if settings.prod_thumb_hover_image and product_images.size > 1
    assign show_hover_image = true
  else
    assign show_hover_image = false
  endif
   
  assign variant_size= product.variants | size
  assign gol_rand = "now" | date: "%d" | Round | plus: product_index| modulo : variant_size
  
  assign cheapest_variant = product.variants[gol_rand]
  assign variant=cheapest_variant
-%}


<div data-product-id="{{ product.id }}" class="product-block" {% if animate %}data-cc-animate{% endif %}>
  <div class="block-inner">
    <div class="block-inner-inner">
      {% if product.featured_media %}
        {%- liquid
          assign aspect_ratios_same = true
          for media in product.media offset: 1
            if media.preview_image.aspect_ratio != product.media.first.preview_image.aspect_ratio
              assign aspect_ratios_same = false
              break
            endif
          endfor
        -%}
        <div class="image-cont {% if show_hover_image %}image-cont--with-secondary-image {% if aspect_ratios_same %}image-cont--same-aspect-ratio{% endif %}{% endif %}">
          <a class="product-link{% if settings.quickbuy_style == 'whole' %} quickbuy-toggle{% endif %}" href="{{ variant.url }}" aria-label="{{ product.title | escape }}" tabindex="-1">
            <div class="image-label-wrap">
              <div>
                {%- if show_hover_image -%}
                  <div class="product-block__image product-block__image--primary{% if product.featured_media.id == product.media.first.id %}{% assign active_media_found = true %} product-block__image--active{% endif %}{% if product_images.last.id == product.featured_media.id %} product-block__image--show-on-hover{% endif %}" data-media-id="{{ product.media.first.id }}">
                    {%- render 'responsive-image', image: variant.image.src, manual_image_load: manual_image_load, min_aspect_ratio: 0.6, aspect_ratio: custom_aspect_ratio, no_max_width: true, cover: settings.prod_thumb_crop -%}
                  </div>
                  {%- for media in product_images offset: 1 -%}
                    {%- liquid
                      assign image_state_class = ''
                      if media.id == product.featured_media.id
                        assign active_media_found = true
                        assign image_state_class = 'product-block__image--active'
                      else
                        if active_media_found
                          assign active_media_found = false
                          assign image_state_class = 'product-block__image--show-on-hover product-block__image--inactivated'
                        else
                          assign image_state_class = 'product-block__image--inactivated'
                        endif
                      endif
                    -%}
                    <div class="product-block__image product-block__image--secondary rimage-wrapper lazyload--placeholder {{ image_state_class }}"
                        data-media-id="{{ media.id }}"
                        data-image-index="{{ forloop.index }}">
                      <div class="lazyload--manual rimage-background fade-in{% if settings.prod_thumb_crop %} cover{% endif %}"
                          data-lazy-bgset-src="{{ media.preview_image | img_url: 'master' }}"
                          data-lazy-bgset-aspect-ratio="{{ media.preview_image.aspect_ratio }}"
                          data-lazy-bgset-width="{{ media.preview_image.width }}"
                          data-sizes="auto"
                          data-parent-fit="{% if settings.prod_thumb_crop %}cover{% else %}contain{% endif %}"></div>
                    </div>
                  {%- endfor -%}
                {%- else -%}
                  <div class="product-block__image product-block__image--primary product-block__image--active" data-media-id="{{ product.featured_media.id }}">
                    {%- render 'responsive-image', image: variant.image.src, manual_image_load: manual_image_load, min_aspect_ratio: 0.6, aspect_ratio: custom_aspect_ratio, no_max_width: true, cover: settings.prod_thumb_crop -%}
                  </div>
                {%- endif -%}
              </div>
              {%- if show_hover_image -%}
                {%- unless no_swiping -%}
                  <div class="product-block__image-dots" aria-hidden="true">
                    <div class="product-block__image-dot product-block__image-dot--active"></div><div class="product-block__image-dot"></div>
                    {%- if product_images.size > 2 -%}
                      <div class="product-block__image-dot product-block__image-dot--more"></div>
                    {%- endif -%}
                  </div>
                {%- endunless -%}
              {%- endif -%}
              {% render 'product-label', product: product, cheapest_variant: cheapest_variant %}
            </div>
          </a>
          {%- if show_hover_image -%}
            <a class="image-page-button image-page-button--previous" href="#" aria-label="{{ 'general.accessibility_labels.previous' | t | escape }}" tabindex="-1">{%- render 'svg-chevron-left', stroke_width: 1.3 -%}</a>
            <a class="image-page-button image-page-button--next" href="#" aria-label="{{ 'general.accessibility_labels.previous' | t | escape }}" tabindex="-1">{%- render 'svg-chevron-right', stroke_width: 1.3 -%}</a>
          {%- endif -%}

          {% if settings.quickbuy_style == 'button' %}
            {% unless no_quick_buy %}
              <!--<a class="btn btn--secondary quickbuy-toggle" href="{{ product_url }}">{{ 'products.quick_buy.launch' | t }}</a>-->
            {% endunless %}
          {% endif %}
        </div>
      {% else %}
        <div class="image-cont">
          <div class="placeholder-image">{{ 'product-1' | placeholder_svg_tag }}</div>
        </div>
      {% endif %}
      

      <div class="product-info">
        <div class="inner">
          <div class="innerer">
            <a class="product-link{% if settings.quickbuy_style == 'whole' %} quickbuy-toggle{% endif %}" href="{{ product_url }}">
              {%- if section.settings.show_vendor -%}
                <div class="vendor">{{ product.vendor }}</div>
              {%- endif -%}
              {% if product.metafields.custom.recycled == true %}
              	<div class="product-block__recycled" style="color:#73855D;font-weight: bold;">
                   <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320.99 320.99"><defs><style>.cls-1{fill:#5c773e;fill-rule:evenodd;}</style></defs><path class="cls-1" d="M105.21,156.85c15.79,9.73,33.47,28.23,41.26,44.8,1.89,3.67,4.36,1.43,4.86-.05,3.91-7.99,8.54-15.68,13.82-22.82,12.21-16.49,28.01-29.97,47.47-37.05l.56-.21,.61-.04c.62-.04,1.2,.02,1.72,.16,.6,.16,1.13,.42,1.58,.74l.02,.02c.46,.33,.82,.72,1.12,1.13,.3,.43,.5,.89,.64,1.36l.05,.25c.07,.33,.11,.67,.11,1,0,.39-.04,.77-.12,1.12v.02c-.15,.59-.41,1.16-.74,1.63-.34,.51-.79,.95-1.28,1.27-21.22,13.73-41.82,34.89-50.88,58.81-4.04,10.67-3.42,20.1-6.7,28.98-3.52,9.53-13.56,12.34-18.84,2.77-4.81-8.72-4.27-23.03-8.26-34.13-6.71-18.68-18.59-28.9-32.85-42.59-1.59-1.52-2.11-3.9-.91-5.83,.63-1.04,1.64-1.76,2.81-2.06,1.31-.33,2.85,.03,3.95,.72Z"/><path class="cls-1" d="M162.96,156.24c-1.99,4.25-3.43,7.33-5.34,8.87-1.63,1.76-3.16,.64-3.41-1.38-.41-63.26,70.98-95.83,126.51-88.37,10.86,51.71-25.71,131.83-85.5,119.15-2.27-.56-2.71-3.04-.64-4.25,1.9-1.03,4.18-.81,6.5-1.12,3.94-.53,7.14-1.3,10.86-3.06,41.12-19.4,48.64-53.61,50.44-90.54-44.63,.63-80.41,18.31-99.42,60.7Z"/><path class="cls-1" d="M114.03,193.19c2.77,.44,2.51,4.14-.04,4.63-59.11,9.77-73.13-39.07-75.63-83.11,41.38-3.03,101.48,.75,105.9,54.55,.3,1.98-1.88,2.95-3.27,1.93-4.8-3.21-7.02-6.91-9.56-11.14-16.27-27.15-48.46-28.63-74.01-27.53,5.41,38.09,18.99,52.84,56.6,60.67Z"/></svg>
                  100% Compostable
                </div>
              {% endif%}
              {% if product.options_by_name['Compatibility'].values.size>0 %}
               <div style="color:#73855D;font-weight: bold;"> <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><style>.cls-1{fill:#5c783d;fill-rule:evenodd;}</style></defs>
             <path class="cls-1" d="M860.31,125.77c-3.33,6.1-6.24,11.47-9.19,16.83-36.45,66.09-72.91,132.18-109.3,198.31-1.42,2.6-3.02,3.74-6.07,3.86-14.92,.61-29.83,1.46-44.72,2.22-23.28,1.21-46.55,2.46-69.82,3.64-13.08,.66-26.17,1.2-39.24,1.84-24.2,1.21-48.39,2.46-72.58,3.67-10.72,.54-21.45,1.07-32.17,1.56-.99,.05-2.47,.64-2.88-.44-.55-1.49,1.16-1.78,2.08-2.32,16.71-9.59,33.43-19.15,50.15-28.72,16.94-9.71,33.85-19.47,50.86-29.08,2.74-1.54,3.36-2.67,1.61-5.63-18.97-32.03-37.75-64.15-56.61-96.22-.69-1.19-1.06-3.21-2.56-3.17-1.47,.03-1.82,2.02-2.49,3.24-34.67,62.74-69.32,125.48-103.97,188.23-2.57,4.65-2.57,4.63-7.31,2.02-64.5-35.53-129-71.07-193.5-106.6-6.48-3.57-6.54-3.57-3.02-9.94,29.38-53.23,58.47-106.63,88.24-159.64,16.92-30.12,42.28-49.59,76.84-55.83,12.2-2.2,24.54-1.8,36.81-.36,10.72,1.27,21.46,.61,32.19,.83,32.09,.69,64.2,.87,96.27,1.75,14.81,.41,29.62,.31,44.41,.64,23.84,.54,47.73,.04,71.5,1.63,26.31,1.77,47.76,13.58,61.67,36.68,16.02,26.61,31.61,53.48,47.2,80.32,1.91,3.26,3.25,3.71,6.56,1.77,27.54-16.24,55.19-32.31,82.81-48.41,1.64-.97,3.2-2.24,6.26-2.66h0Zm-352.61,45.7c-.57-1.04-1.08-2.1-1.7-3.07-10.36-16.39-20.76-32.76-31.11-49.16-4.75-7.53-9.14-15.34-15.53-21.68-22.46-22.21-50.02-28.77-80.3-24.54-28.25,3.94-49.17,20.06-62.97,44.37-27.65,48.78-54.37,98.08-81.55,147.12-1.33,2.41-1,3.52,1.42,4.82,11.42,6.14,22.76,12.45,34.12,18.72,43.26,23.83,86.54,47.63,129.76,71.54,2.49,1.37,3.61,1.32,5.06-1.39,7.56-14.08,15.37-28.03,23.1-42.02,26.09-47.25,52.17-94.52,78.25-141.77,.51-.91,.93-1.87,1.45-2.94h0Z"/><path class="cls-1" d="M38.12,349.99c1.21-1.32,2.75-.87,4.11-.87,80.22-.07,160.44-.1,240.64-.23,3.19,0,4.95,1.16,6.57,3.79,33.29,53.99,66.66,107.93,100.02,161.87,11.86,19.17,23.73,38.32,35.57,57.49,.64,1.06,1.7,2.02,1.35,3.55-1.69,.39-2.69-.9-3.83-1.59-32.49-19.72-64.95-39.47-97.42-59.21q-4.75-2.88-7.53,1.85c-18.62,31.46-37.27,62.9-55.88,94.37-2.72,4.59-2.63,4.73,2.76,4.73,70.65,0,141.3,0,211.95,0,1.32,0,2.62,.08,3.94,0,2.89-.16,3.92,1.26,3.92,4.05-.02,8.51,.12,17.04,.14,25.55,.04,65.94,.06,131.86,.09,197.8q0,6.48-6.34,6.5c-60.68,0-121.37,.39-182.05-.14-47.94-.41-82.94-22.33-102.84-66.35-9.84-21.77-21.62-42.49-32.65-63.61-20.3-38.91-41.05-77.59-61.62-116.38-7.05-13.31-14.51-26.44-21.07-39.99-12.24-25.26-12.39-50.56,1.91-75.16,15.41-26.5,31.15-52.83,46.91-79.13,1.94-3.24,1.25-4.53-1.72-6.29-27.74-16.42-55.4-32.96-83.08-49.51-1.4-.84-3.18-1.27-3.85-3.09h0Zm317.65,285.66c-34.6,0-69.21,.04-103.82-.06-3.3,0-5.18,1.02-6.79,3.97-10.27,18.72-20.5,37.48-31.22,55.95-10.09,17.39-14.04,35.87-10.14,55.53,5.5,27.7,18.44,50.87,43.34,65.91,15.08,9.1,31.7,13.13,49.14,13.21,42.73,.21,85.46,.07,128.2,.07,12.06,0,24.13-.06,36.18,.04,2.84,.03,4.11-.88,3.97-3.82-.17-3.79-.16-7.61-.16-11.4v-173.82c0-5.56,0-5.58-5.67-5.58h-103.04Z"/><path class="cls-1" d="M641.36,947.96c-1.37-.34-1.66-1.6-2.24-2.58-39.88-69.28-79.72-138.58-119.69-207.83-2.13-3.7-2.29-6.58-.21-10.44,32.89-60.57,65.61-121.24,98.38-181.88,7.72-14.3,15.43-28.6,23.15-42.9,.71-1.32,1.18-2.87,3.17-3.92,0,6.12,.35,11.82-.07,17.49-.74,9.96-.37,19.91-.66,29.87-.64,22.26-1.07,44.53-1.63,66.79-.26,10.02-.3,9.95,9.62,10.04,33.81,.31,67.62,.68,101.42,1.07,1.84,.02,3.65,.37,5.48,.44,1,.04,2.29,.49,2.92-.54,.64-1.06-.39-1.94-.89-2.82-6-10.47-12.02-20.91-18.03-31.36-30.02-52.28-60.01-104.57-90.14-156.78-1.92-3.31-1.47-4.68,1.82-6.56,64.77-37.2,129.5-74.51,194.14-111.92,3.54-2.04,4.98-1.47,6.92,1.91,30.46,53.23,61.05,106.38,91.56,159.59,10.95,19.1,16.24,39.71,15.41,61.72-.71,18.88-6.31,36.43-16.86,52.09-47.56,70.7-91.13,143.92-137.09,215.62-13.05,20.37-31.25,33.19-55.34,37.08-6.07,.99-12.22,.71-18.39,.56-15.46-.4-30.94-.24-46.4-.38-13.23-.14-26.47-.29-39.69-.61-3.1-.07-4.02,1.02-4.15,4.06-.69,16.76-.14,33.54-.8,50.3-.62,16.11-.3,32.23-.73,48.34-.03,1.21,.39,2.64-1,3.55h0Zm300.73-414.38c-.1-17.96-4.6-33.89-13.16-48.74-9.57-16.57-19.08-33.16-28.6-49.76-17.74-30.92-35.5-61.83-53.19-92.77-1.37-2.37-2.42-3.47-5.41-1.74-53.55,30.97-107.15,61.85-160.8,92.61-3.45,1.98-3.85,3.47-1.85,6.92,33.02,57.21,66.14,114.35,98.54,171.9,5.24,9.27,10.59,13.24,21.43,12.42,16.95-1.29,34.04,.06,51.08-.64,7.32-.31,14.61-.23,21.84-1.65,38.88-7.68,71.5-53.06,70.12-88.55h0Z"/></svg>
            Reclaimed Materials
             </div>     
                <div class="product-block-compatibility">{{ variant.option2 }}</div>
              {% endif  %}
              {% if  product.metafields.custom.is_case==true %}
                <div class="product-block__design">
                 {% if product.metafields.custom.design != blank %}
                    {{ product.metafields.custom.design }}
              	 {% else %}
                     {% if variant.option1 != blank %}
                        {{ variant.option1 }}
                	 {% endif%}
                 {% endif%}
                </div>
                 {% if product.metafields.custom.series_type != blank %}
                     <div class="product-block__series-type">{{ product.metafields.custom.series_type | split:' '| first }} Collection</div>
              	 {% endif%}
              	  <div class="product-block__model">{{ variant.option2 | split:'-'| last }}</div>
              {% else%}
                 <div class="product-block__title">{{ product.title }}</div>
              {% endif%}
			  <div class="product-block__color-size">{{ product.options_by_name['Color'].values.size }} {% if product.options_by_name['Color'].values.size!=1 %} Colors {% else %} Color{% endif %}</div>

              {%- if settings.prod_thumb_show_subtitle and product.metafields.descriptors.subtitle != blank -%}
                <div class="product-block__subtitle">{{ product.metafields.descriptors.subtitle }}</div>
              {%- endif -%}

              <div class="product-price">
                {% if product.price_varies %}
                  <span class="product-price__item product-price__from">{{ 'products.listing.from' | t }}</span>
                {% endif %}
                <span class="product-price__item product-price__amount {% if cheapest_variant.compare_at_price > cheapest_variant.price %}product-price__amount--on-sale{% endif %} theme-money">
                  {%- if settings.product_currency_code_enabled -%}
                    {{ cheapest_variant.price | money_without_trailing_zeros }}
                  {%- else -%}
                    {{ cheapest_variant.price | money_without_trailing_zeros }}
                  {%- endif -%}
                </span>
                {% if cheapest_variant.compare_at_price > cheapest_variant.price %}
                  <span class="product-price__item product-price__compare theme-money">{{ cheapest_variant.compare_at_price | money }}</span>
                {% endif %}

                {% if settings.prod_sold_out_show and product.available == false %}
                  <span class="product-price__item price-label price-label--sold-out">{{ 'products.labels.sold_out' | t }}</span>
                {% elsif settings.prod_pre_order_label_show and product.template_suffix contains 'preorder' %}
                  <span class="product-price__item price-label price-label--preorder">{{ 'products.product.preorder' | t }}</span>
                {% elsif settings.prod_sale_show and cheapest_variant.compare_at_price > cheapest_variant.price %}
                  <span class="product-price__item price-label price-label--sale">{{ 'products.labels.sale' | t }}</span>
                {% endif %}
              </div>
              {% render 'unit-price', variant: cheapest_variant %}
            </a>

            {%- if settings.prod_thumb_show_options -%}
              {%- liquid
                 assign option_limit = 3
                 assign options_to_show = settings.swatch_option_name | append: ',' | append: settings.prod_thumb_options_names | replace: ', ', ',' | split: ','
              -%}
              {%- for product_option in product.options_with_values -%}
                {%- if options_to_show contains product_option.name -%}
                  {%- liquid
                    if settings.swatch_enabled and settings.swatch_option_name contains product_option.name
                      assign is_swatch = true
                    else
                      assign is_swatch = false
                    endif
                  -%}
                  <div class="product-block-options{% if is_swatch %} product-block-options--swatch{% endif %}" data-option-name="{{ product_option.name | escape }}">
                    <div class="product-block-options__inner">
                      {%- if product.options.size == 1 -%}
                        {%- for variant in product.variants -%}
                          {%- liquid
                            if is_swatch and settings.swatch_method == 'image' and variant.featured_media == blank
                              continue
                            endif
                          -%}
                          <span class="product-block-options__item{% unless settings.prod_thumb_options_disable_unavailable == false or variant.available %} product-block-options__item--unavailable{% endunless %}{% if forloop.index > option_limit and is_swatch %} product-block-options__item--truncated{% endif %}{% if is_swatch %} lazyload{% if manual_image_load %}--manual{% endif %}{% endif %}"
                            data-option-item="{{ variant.title | downcase | escape }}"
                            {% if variant.featured_media %}data-media="{{ variant.featured_media.id }}"{% endif %}
                            {% if is_swatch -%}
                              {%- if settings.swatch_method == 'standard' -%}
                                data-swatch="{{ variant.title | escape | downcase }}"
                              {%- elsif settings.swatch_method == 'image' and variant.featured_media.preview_image -%}
                                data-bgset="{{ variant.featured_media.preview_image | img_url: '48x48', crop: settings.swatch_crop_align }}"
                              {%- endif -%}
                            {%- endif %}><span class="product-block-options__item__text">{{ variant.title }}</span></span>
                        {%- endfor -%}
                        {%- if product.variants.size > option_limit and is_swatch -%}
                          {%- assign remaining = product.variants.size | minus: option_limit -%}
                          <span class="product-block-options__more-label">{{ 'collections.general.more_swatches' | t: count: remaining }}</span>
                        {%- endif -%}
                      {%- else -%}
                        {%- assign product_option_position_0index = product_option.position | minus: 1 -%}
                        {%- for product_option_value in product_option.values -%}
                          {%- liquid
                            assign option_value_variant = false
                            for variant in product.variants
                              if variant.options[product_option_position_0index] == product_option_value
                                assign option_value_variant = variant
                                break
                              endif
                            endfor

                            if settings.prod_thumb_options_disable_unavailable
                              assign is_unavailable = true
                              for variant in product.variants
                                if variant.available and variant.options[product_option_position_0index] == product_option_value
                                  assign is_unavailable = false
                                  break
                                endif
                              endfor
                            else
                              assign is_unavailable = false
                            endif

                            if is_swatch and settings.swatch_method == 'image' and option_value_variant.featured_media == blank
                              continue
                            endif
                          -%}
                          <span class="product-block-options__item{% if is_unavailable %} product-block-options__item--unavailable{% endif %}{% if forloop.index > option_limit and is_swatch %} product-block-options__item--truncated{% endif %}{% if is_swatch %} lazyload{% if manual_image_load %}--manual{% endif %}{% endif %}"
                            data-option-item="{{ product_option_value | downcase | escape }}"
                            {% if option_value_variant.featured_media %}data-media="{{ option_value_variant.featured_media.id }}"{% endif %}
                            {% if is_swatch %}
                              {%- if settings.swatch_method == 'standard' -%}
                                data-swatch="{{ product_option_value | escape | downcase }}"
                              {%- elsif settings.swatch_method == 'image' and option_value_variant.featured_media -%}
                                data-bgset="{{ option_value_variant.featured_media.preview_image | img_url: '48x48', crop: settings.swatch_crop_align }}"
                              {%- endif -%}
                            {% endif %}><span class="product-block-options__item__text">{{ product_option_value }}</span></span>
                        {%- endfor -%}
                        {%- if product_option.values.size > option_limit and is_swatch -%}
                          {%- assign remaining = product_option.values.size | minus: option_limit -%}
                          <span class="product-block-options__more-label">{{ 'collections.general.more_swatches' | t: count: remaining }}</span>
                        {%- endif -%}
                      {%- endif -%}
                    </div>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}

            {%- if settings.enable_product_reviews_collection and product.metafields.reviews.rating_count != blank and product.metafields.reviews.rating_count > 0 -%}
              <div class="product-block__rating">
                {% render 'rating', rating_value: product.metafields.reviews.rating.value %}
                <span class="cc-rating-custom-caption">
                  {{ product.metafields.reviews.rating_count }} {{ 'products.product.reviews_link' | t: count: product.metafields.reviews.rating_count | downcase }}
                </span>
              </div>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </div>

  {%- if settings.quickbuy_style != 'off' -%}
    {%- unless no_quick_buy_markup or no_quick_buy -%}
      <div class="quickbuy-container">
        <a href="#" class="close-detail" aria-label="{{ 'products.quick_buy.close' | t }}" tabindex="-1">{% render 'svg-x' %}</a>
        <div class="inner"></div>
      </div>
    {%- endunless -%}
  {%- endif -%}
</div>

